#!/bin/bash
cd /home/container

# Print current Java version
JAVA_VER=`java -version 2>&1 | head -1 | cut -d'"' -f2 | sed '/^1\./s///'`
echo "Java version: ${JAVA_VER}"

# Make internal Docker IP address available to processes
export INTERNAL_IP=`ip route get 1 | awk '{print $(NF-2);exit}'`

# Download Spigot Anti-Malware from Github Releases
curl --silent -Lo /home/container/antimalware.jar https://github.com/OpticFusion1/MCAntiMalware/releases/latest/download/MCAntiMalware.jar

# Print startup command to console
echo -e "\033[1;33mINFO: \033[0mStarting Anti-Malware scan..."

# Run Spigot Anti-Malware then remove startup .jar file
java -jar /home/container/antimalware.jar --singleScan true
rm /home/container/antimalware.jar

echo -e "\033[1;33mINFO: \033[0mScan complete."
